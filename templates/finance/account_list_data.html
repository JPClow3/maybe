{# Account list content (loaded via HTMX) - Table only, summary cards updated separately #}
{% load money_filters %}

{# Update account count badge in header #}
<span id="account-count-badge" class="px-2 py-0.5 rounded-full bg-white/5 border border-white/10 text-xs font-mono text-gray-500" hx-swap-oob="true">{{ account_count }}</span>

{# Update Summary Cards with hx-swap-oob #}
<div id="account-summary-cards" class="grid grid-cols-1 md:grid-cols-3 gap-6" hx-swap-oob="true">
    {# Total Assets Card #}
    <div class="card card-spotlight rounded-2xl relative overflow-hidden group">
        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity duration-500">
            {% include 'partials/account_summary_icon.html' with icon_type='assets' %}
        </div>
        <div class="relative z-10">
            <p class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Total Assets</p>
            <p class="text-3xl font-bold text-emerald-400 balance-display text-shadow-emerald">
                {{ total_assets|real_br_plain }}
            </p>
            <div class="h-1 w-full bg-white/5 mt-4 rounded-full overflow-hidden">
                {% if total_assets > 0 %}
                <div class="h-full bg-indigo-500 w-3/4 shadow-[0_0_10px_#6366f1]"></div>
                {% endif %}
            </div>
        </div>
    </div>
    
    {# Total Liabilities Card #}
    <div class="card card-spotlight rounded-2xl relative overflow-hidden group">
        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity duration-500">
            {% include 'partials/account_summary_icon.html' with icon_type='liabilities' %}
        </div>
        <div class="relative z-10">
            <p class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-2">Total Liabilities</p>
            <p class="text-3xl font-bold text-rose-400 balance-display text-shadow-rose">
                {{ total_liabilities|real_br_plain }}
            </p>
            <div class="h-1 w-full bg-white/5 mt-4 rounded-full overflow-hidden">
                {% if total_liabilities > 0 %}
                <div class="h-full bg-rose-500 w-1/4 shadow-[0_0_10px_#f43f5e]"></div>
                {% endif %}
            </div>
        </div>
    </div>

    {# Net Worth Card #}
    <div class="card card-spotlight rounded-2xl relative overflow-hidden group border-indigo-500/30 bg-gradient-to-br from-indigo-500/10 to-transparent">
        <div class="absolute -inset-1 bg-gradient-to-r from-indigo-500/20 to-fuchsia-500/20 blur-2xl opacity-50 group-hover:opacity-70 transition-opacity"></div>
        <div class="relative z-10">
            <p class="text-xs font-semibold text-indigo-400 uppercase tracking-widest mb-2">Net Worth</p>
            <div class="relative">
                <svg class="absolute inset-x-0 -bottom-3 h-8 w-full opacity-40 pointer-events-none" viewBox="0 0 100 20" preserveAspectRatio="none" aria-hidden="true">
                    <defs>
                        <linearGradient id="netWorthSparklineGradient" x1="0" y1="0" x2="100" y2="0" gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#6366f1"/>
                            <stop offset="1" stop-color="#ec4899"/>
                        </linearGradient>
                    </defs>
                    <path d="M0 18 L10 12 L20 14 L30 8 L40 10 L50 4 L60 9 L70 6 L80 11 L90 5 L100 7" fill="none" stroke="url(#netWorthSparklineGradient)" stroke-width="1.5" stroke-linecap="round" class="drop-shadow-neon" />
                </svg>
                <p class="text-4xl font-bold {% if net_worth >= 0 %}text-emerald-400 text-shadow-emerald{% else %}text-rose-400 text-shadow-rose{% endif %} balance-display relative">
                    {{ net_worth|real_br_plain }}
                </p>
            </div>
            {% if net_worth >= 0 %}
            <div class="flex items-center gap-2 mt-4 text-xs text-emerald-400">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"/>
                </svg>
                <span>Tracking healthy</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{# Account List Table - This is what gets swapped in #}
<div class="card rounded-2xl overflow-hidden min-h-[500px]">
    {% if accounts %}
        {# Table Header #}
        <div class="grid grid-cols-12 gap-4 px-6 py-3 border-b border-white/5 text-[10px] font-bold text-gray-500 uppercase tracking-widest bg-black/20">
            <div class="col-span-6 md:col-span-5">Account Name</div>
            <div class="col-span-3 hidden md:block">Institution</div>
            <div class="col-span-3 hidden md:block">Type</div>
            <div class="col-span-6 md:col-span-1 text-right">Balance</div>
        </div>

        <div class="divide-y divide-white/5">
            {% for account in accounts %}
            <a href="{% url 'account_detail' account.pk %}" class="grid grid-cols-12 gap-4 px-6 py-4 items-center hover:bg-white/[0.03] transition-all cursor-pointer relative border-l-2 border-transparent hover:border-luma-indigo" hx-boost="true" hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML">
                {# Account Name Column #}
                <div class="col-span-6 md:col-span-5 flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center border border-white/5 group-hover:border-white/20 group-hover:shadow-glow transition-all duration-300
                        {% if account.accountable_type == 'investment' %}text-luma-fuchsia
                        {% elif account.accountable_type == 'depository' %}text-emerald-400
                        {% elif account.accountable_type == 'credit_card' %}text-luma-rose
                        {% elif account.accountable_type == 'crypto' %}text-orange-400
                        {% else %}text-slate-400{% endif %}">
                        {% if account.accountable_type == 'depository' %}
                            <i data-lucide="wallet" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'investment' %}
                            <i data-lucide="trending-up" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'credit_card' %}
                            <i data-lucide="credit-card" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'loan' %}
                            <i data-lucide="landmark" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'crypto' %}
                            <i data-lucide="bitcoin" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'property' %}
                            <i data-lucide="home" class="w-5 h-5"></i>
                        {% elif account.accountable_type == 'vehicle' %}
                            <i data-lucide="car" class="w-5 h-5"></i>
                        {% else %}
                            <i data-lucide="circle" class="w-5 h-5"></i>
                        {% endif %}
                    </div>
                    <div>
                        <div class="font-medium text-white group-hover:text-indigo-400 transition-colors">{{ account.name }}</div>
                        <div class="text-xs text-gray-500 md:hidden font-mono tabular-nums mt-0.5">
                            {% if account.classification == 'liability' and account.balance < 0 %}-{% endif %}{{ account.balance|real_br_plain }}
                        </div>
                    </div>
                </div>

                {# Institution Column #}
                <div class="col-span-3 hidden md:flex items-center gap-2">
                    {% if account.accountable_data.institution %}
                        {% with first_char=account.accountable_data.institution|first|upper %}
                        {% if first_char == 'V' %}
                        <div class="w-5 h-5 rounded-full bg-red-900/50 flex items-center justify-center text-[10px] text-red-200 font-bold">{{ first_char }}</div>
                        {% elif first_char == 'C' %}
                        <div class="w-5 h-5 rounded-full bg-blue-900/50 flex items-center justify-center text-[10px] text-blue-200 font-bold">{{ first_char }}</div>
                        {% elif first_char == 'A' %}
                        <div class="w-5 h-5 rounded-full bg-cyan-900/50 flex items-center justify-center text-[10px] text-cyan-200 font-bold">{{ first_char }}</div>
                        {% else %}
                        <div class="w-5 h-5 rounded-full bg-indigo-900/50 flex items-center justify-center text-[10px] text-indigo-200 font-bold">{{ first_char }}</div>
                        {% endif %}
                        {% endwith %}
                        <span class="text-sm text-gray-400">{{ account.accountable_data.institution }}</span>
                    {% else %}
                        <i data-lucide="circle" class="w-4 h-4 text-gray-600"></i>
                        <span class="text-sm text-gray-400">Manual Account</span>
                    {% endif %}
                </div>

                {# Type Column #}
                <div class="col-span-3 hidden md:block">
                    {% if account.accountable_type == 'investment' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-luma-fuchsia/10 text-luma-fuchsia border border-luma-fuchsia/20">
                            Investment
                        </span>
                    {% elif account.accountable_type == 'depository' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                            Depository
                        </span>
                    {% elif account.accountable_type == 'credit_card' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-rose-500/10 text-rose-400 border border-rose-500/20">
                            Credit Card
                        </span>
                    {% elif account.accountable_type == 'loan' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-rose-500/10 text-rose-400 border border-rose-500/20">
                            Loan
                        </span>
                    {% elif account.accountable_type == 'crypto' %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-orange-500/10 text-orange-400 border border-orange-500/20">
                            Crypto
                        </span>
                    {% else %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium tracking-wide uppercase bg-slate-500/10 text-slate-400 border border-slate-500/20">
                            {{ account.get_accountable_type_display }}
                        </span>
                    {% endif %}
                </div>

                {# Balance Column #}
                <div class="col-span-6 md:col-span-1 text-right hidden md:block">
                    <span class="font-mono font-bold text-sm tracking-tight tabular-nums
                        {% if account.classification == 'asset' %}
                            text-white
                            {% if account.accountable_type == 'depository' %}text-shadow-emerald{% endif %}
                        {% else %}
                            text-rose-400 text-shadow-rose
                        {% endif %}">
                        {% if account.classification == 'liability' and account.balance < 0 %}-{% endif %}{{ account.balance|real_br_plain }}
                    </span>
                    <div class="text-[10px] text-gray-600 mt-0.5">Synced {{ account.updated_at|time_ago }}</div>
                </div>

                {# Mobile chevron #}
                <div class="absolute right-4 top-1/2 -translate-y-1/2 md:hidden text-gray-600">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </div>
            </a>
            {% endfor %}
        </div>
    {% else %}
        {# Empty State #}
        <div class="flex flex-col items-center justify-center py-12 text-center">
            <div class="opacity-20 mb-4">
                <i data-lucide="wallet" class="w-16 h-16 text-slate-400"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-200 mb-2">No accounts found</h3>
            <p class="text-sm text-slate-400 mb-6">Get started by creating your first account to track your finances.</p>
            <a href="{% url 'account_new' %}" class="btn-primary">Add First Account</a>
        </div>
    {% endif %}
</div>
