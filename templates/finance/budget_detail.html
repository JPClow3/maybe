{% extends 'base.html' %}
{% load money_filters %}

{% block title %}Orçamento {{ budget.start_date|date:"F Y" }} - Maybe Finance{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
    <div class="mb-6">
        <a href="{% url 'budget_list' %}" class="text-indigo-400 hover:text-indigo-300 mb-4 inline-block">← Voltar para Orçamentos</a>
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold tracking-tighter bg-gradient-to-r from-indigo-500 via-violet-600 to-indigo-500 bg-clip-text text-transparent">
                    Orçamento {{ budget.start_date|date:"F Y" }}
                </h1>
                <p class="text-sm text-slate-400 mt-1">
                    {{ budget.start_date|date:"d/m/Y" }} - {{ budget.end_date|date:"d/m/Y" }}
                </p>
            </div>
            <a href="{% url 'budget_edit' budget.pk %}" class="btn-secondary">
                Editar
            </a>
        </div>
    </div>
    
    {# Overall budget summary #}
    {% if budget.budgeted_spending %}
    <div class="card mb-6">
        <h2 class="text-lg font-semibold text-gray-200 mb-4">Resumo do Orçamento</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <p class="text-sm text-slate-400 mb-1">Orçado</p>
                <p class="text-2xl font-bold text-gray-200 balance-display font-mono">{{ budget.budgeted_spending|real_br }}</p>
            </div>
            <div>
                <p class="text-sm text-slate-400 mb-1">Gasto</p>
                <p class="text-2xl font-bold {% if budget.actual_spending > budget.budgeted_spending %}text-rose-400{% else %}text-gray-200{% endif %} balance-display font-mono">
                    {{ budget.actual_spending|real_br }}
                </p>
            </div>
            <div>
                <p class="text-sm text-slate-400 mb-1">Disponível</p>
                <p class="text-2xl font-bold {% if budget.available_to_spend < 0 %}text-rose-400{% else %}text-emerald-400{% endif %} balance-display font-mono">
                    {{ budget.available_to_spend|real_br }}
                </p>
            </div>
        </div>
        
        {# Overall progress bar #}
        {% with percent=budget.actual_spending|div:budget.budgeted_spending|mul:100|floatformat:0 %}
        <div class="mt-4">
            <div class="flex justify-between text-sm mb-2">
                <span class="text-slate-400">Progresso</span>
                <span class="font-semibold text-gray-200 font-mono">{{ percent }}%</span>
            </div>
            <div class="w-full bg-white/5 rounded-full h-3">
                <div 
                    class="h-3 rounded-full transition-all {% if percent|add:0 > 100 %}bg-rose-500{% elif percent|add:0 > 80 %}bg-amber-400{% else %}bg-emerald-500{% endif %}"
                    style="width: {% if percent|add:0 > 100 %}100{% else %}{{ percent }}{% endif %}%"
                ></div>
            </div>
        </div>
        {% endwith %}
    </div>
    {% endif %}
    
    {# Category breakdown #}
    <div class="card">
        <h2 class="text-lg font-semibold text-gray-200 mb-4">Gastos por Categoria</h2>
        
        {% if budget_categories %}
        <div class="space-y-4">
            {% for bc in budget_categories %}
            {% if not bc.subcategory %}
            <div class="border-b border-white/5 pb-4 last:border-0">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1">
                        <h3 class="font-medium text-gray-200">
                            {{ bc.category.name|default:"Sem categoria" }}
                        </h3>
                        <div class="flex justify-between text-sm mt-2">
                            <span class="text-slate-400">
                                Orçado: {{ bc.budgeted_spending|real_br|default:"R$ 0,00" }}
                            </span>
                            <span class="text-slate-400">
                                Gasto: {{ bc.actual|real_br }}
                            </span>
                        </div>
                    </div>
                    <div class="text-right ml-4">
                        <p class="text-lg font-semibold {% if bc.available < 0 %}text-rose-400{% else %}text-emerald-400{% endif %} balance-display font-mono">
                            {{ bc.available|real_br }}
                        </p>
                        <p class="text-xs text-slate-400">disponível</p>
                    </div>
                </div>
                
                {# Category progress bar #}
                {% if bc.budgeted_spending %}
                {% with percent=bc.actual|div:bc.budgeted_spending|mul:100|floatformat:0 %}
                <div class="mt-2">
                    <div class="w-full bg-white/5 rounded-full h-2">
                        <div 
                            class="h-2 rounded-full transition-all {% if percent|add:0 > 100 %}bg-rose-500{% elif percent|add:0 > 80 %}bg-amber-400{% else %}bg-emerald-500{% endif %}"
                            style="width: {% if percent|add:0 > 100 %}100{% else %}{{ percent }}{% endif %}%"
                        ></div>
                    </div>
                    <p class="text-xs text-slate-400 mt-1 font-mono">{{ percent }}% utilizado</p>
                </div>
                {% endwith %}
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
            <p class="text-slate-400">Nenhuma categoria configurada. Edite o orçamento para adicionar categorias.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

