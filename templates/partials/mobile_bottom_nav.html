{# Mobile Bottom Navigation Bar - visible only on mobile #}
<nav 
    class="fixed bottom-0 left-0 right-0 border-t border-white/10 bg-[#121212]/90 backdrop-blur-md z-40 block md:hidden"
    role="navigation"
    aria-label="Mobile navigation"
>
    <div class="flex items-center justify-around h-16 px-2">
        {# Dashboard/Home #}
        {% with url_name=request.resolver_match.url_name %}
        <a 
            href="{% url 'dashboard' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'dashboard' or url_name == 'dashboard_stats' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Dashboard"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span class="text-xs mt-1">Início</span>
        </a>
        
        {# Transactions #}
        <a 
            href="{% url 'transaction_list' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'transaction_list' or url_name == 'transaction_detail' or url_name == 'transaction_new' or url_name == 'transaction_edit' or url_name == 'transaction_update_category' or url_name == 'transaction_update_amount' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Transactions"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <span class="text-xs mt-1">Transações</span>
        </a>
        {% endwith %}
        
        {# Floating Add Button - takes space but is visually separate #}
        <div class="flex-1 flex items-center justify-center relative">
            <button
                @click="$dispatch('open-transaction-modal')"
                class="absolute -top-8 w-16 h-16 bg-primary-600 text-white rounded-full shadow-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-colors flex items-center justify-center"
                aria-label="Adicionar transação"
            >
                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>
        </div>
        
        {# Investments #}
        {% with url_name=request.resolver_match.url_name %}
        <a 
            href="{% url 'security_list' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'security_list' or url_name == 'holding_list' or url_name == 'trade_list' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Investments"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
            <span class="text-xs mt-1">Investimentos</span>
        </a>
        {% endwith %}
        
        {# Profile / menu - opens mobile panel #}
        <button 
            type="button"
            @click="mobilePanelOpen = true"
            class="flex flex-col items-center justify-center flex-1 h-full text-gray-400 hover:text-indigo-400 transition-colors"
            aria-label="Profile and settings"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="text-xs mt-1">Perfil</span>
        </button>
    </div>
</nav>

{# Mobile slide-over panel for navigation/profile #}
<div
    x-show="mobilePanelOpen"
    x-transition.opacity
    class="fixed inset-0 z-50 md:hidden bg-black/60 backdrop-blur-sm"
    @click.self="mobilePanelOpen = false"
    @keydown.escape.window="mobilePanelOpen = false"
    aria-hidden="true"
>
    <div
        class="absolute inset-y-0 right-0 w-80 max-w-full card rounded-none rounded-l-2xl flex flex-col"
    >
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
                <div class="relative w-8 h-8 flex items-center justify-center">
                    <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-[0_0_10px_rgba(99,102,241,0.5)]">
                        <defs>
                            <linearGradient id="prismGradMobile" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#6366f1" />
                                <stop offset="100%" stop-color="#06b6d4" />
                            </linearGradient>
                        </defs>
                        <path d="M50 5 L93.3 25 V75 L50 95 L6.7 75 V25 Z" fill="none" stroke="url(#prismGradMobile)" stroke-width="6" />
                        <path d="M50 5 L50 50 L93.3 25" fill="none" stroke="url(#prismGradMobile)" stroke-width="2" stroke-opacity="0.5" />
                    </svg>
                </div>
                <div>
                    <p class="text-sm font-semibold text-white">Luma</p>
                    <p class="text-[11px] text-slate-400">Ambient Finance</p>
                </div>
            </div>
            <button
                type="button"
                class="text-gray-400 hover:text-white"
                @click="mobilePanelOpen = false"
                aria-label="Close menu"
            >
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <nav class="space-y-1 mt-2">
            {% url 'dashboard' as dashboard_url %}
            <a href="{{ dashboard_url }}"
               class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-all text-gray-400 hover:text-white hover:bg-white/5"
               hx-boost="true"
               hx-target="#main-content"
               hx-select="#main-content"
               hx-swap="innerHTML"
               @click="mobilePanelOpen = false">
                <i data-lucide="layout-grid" class="w-4 h-4"></i>
                Dashboard
            </a>

            {% url 'account_list' as account_list_url %}
            <a href="{{ account_list_url }}"
               class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-all text-gray-400 hover:text-white hover:bg-white/5"
               hx-boost="true"
               hx-target="#main-content"
               hx-select="#main-content"
               hx-swap="innerHTML"
               @click="mobilePanelOpen = false">
                <i data-lucide="wallet" class="w-4 h-4"></i>
                Accounts
            </a>

            {% url 'transaction_list' as transaction_list_url %}
            <a href="{{ transaction_list_url }}"
               class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-all text-gray-400 hover:text-white hover:bg-white/5"
               hx-boost="true"
               hx-target="#main-content"
               hx-select="#main-content"
               hx-swap="innerHTML"
               @click="mobilePanelOpen = false">
                <i data-lucide="arrow-left-right" class="w-4 h-4"></i>
                Transactions
            </a>

            {% url 'security_list' as security_list_url %}
            <a href="{{ security_list_url }}"
               class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-all text-gray-400 hover:text-white hover:bg-white/5"
               hx-boost="true"
               hx-target="#main-content"
               hx-select="#main-content"
               hx-swap="innerHTML"
               @click="mobilePanelOpen = false">
                <i data-lucide="trending-up" class="w-4 h-4"></i>
                Investments
            </a>
        </nav>

        <div class="mt-6 pt-4 border-t border-white/5 flex items-center gap-3">
            <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-luma-indigo to-luma-cyan p-[1px]">
                <div class="w-full h-full rounded-full bg-black flex items-center justify-center text-xs font-bold text-white">
                    {{ user.username|slice:":2"|upper }}
                </div>
            </div>
            <div class="overflow-hidden">
                <p class="text-sm font-medium text-white truncate">{{ user.username }}</p>
                <p class="text-[11px] text-slate-500 uppercase tracking-wider">Pro Member</p>
            </div>
        </div>
    </div>
</div>

{# Modal for quick transaction add - using native dialog element #}
<dialog
    x-data="{ open: false }"
    @open-transaction-modal.window="open = true; $refs.dialog.showModal()"
    @close-dialog.window="open = false; $refs.dialog.close()"
    @click.away="if ($event.target === $refs.dialog) { open = false; $refs.dialog.close() }"
    x-ref="dialog"
    class="rounded-lg shadow-xl max-w-md w-full p-0 backdrop:bg-black/50"
>
    <div 
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 scale-90"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-90"
        class="p-6"
    >
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Nova Transação</h2>
            <button
                @click="open = false; $refs.dialog.close()"
                class="text-gray-400 hover:text-gray-600"
                aria-label="Fechar"
            >
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div 
            hx-get="{% url 'transaction_quick_form' %}"
            hx-trigger="load"
            hx-swap="innerHTML"
            class="space-y-4"
        >
            {# Loading state #}
            <div class="flex items-center justify-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
            </div>
        </div>
    </div>
</dialog>

{# Add bottom padding to main content on mobile to avoid overlap with bottom nav #}
<style>
    @media (max-width: 768px) {
        main {
            padding-bottom: 5rem; /* 4rem nav + 1rem spacing */
        }
    }
</style>

