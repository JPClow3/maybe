{# Mobile Bottom Navigation Bar - visible only on mobile #}
<nav 
    class="header-glass fixed bottom-0 left-0 right-0 border-t border-gray-200 dark:border-gray-800 z-40 block md:hidden"
    role="navigation"
    aria-label="Mobile navigation"
>
    <div class="flex items-center justify-around h-16 px-2">
        {# Dashboard/Home #}
        {% with url_name=request.resolver_match.url_name %}
        <a 
            href="{% url 'dashboard' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'dashboard' or url_name == 'dashboard_stats' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Dashboard"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span class="text-xs mt-1">Início</span>
        </a>
        
        {# Transactions #}
        <a 
            href="{% url 'transaction_list' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'transaction_list' or url_name == 'transaction_detail' or url_name == 'transaction_new' or url_name == 'transaction_edit' or url_name == 'transaction_update_category' or url_name == 'transaction_update_amount' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Transactions"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <span class="text-xs mt-1">Transações</span>
        </a>
        {% endwith %}
        
        {# Floating Add Button - takes space but is visually separate #}
        <div class="flex-1 flex items-center justify-center relative">
            <button
                @click="$dispatch('open-transaction-modal')"
                class="absolute -top-8 w-16 h-16 bg-primary-600 text-white rounded-full shadow-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-colors flex items-center justify-center"
                aria-label="Adicionar transação"
            >
                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>
        </div>
        
        {# Investments #}
        {% with url_name=request.resolver_match.url_name %}
        <a 
            href="{% url 'security_list' %}"
            class="flex flex-col items-center justify-center flex-1 h-full {% if url_name == 'security_list' or url_name == 'holding_list' or url_name == 'trade_list' %}text-primary-600 dark:text-primary-400{% else %}text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400{% endif %} transition-colors"
            hx-boost="true"
            hx-target="#main-content" hx-select="#main-content" hx-swap="innerHTML"
            aria-label="Investments"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
            <span class="text-xs mt-1">Investimentos</span>
        </a>
        {% endwith %}
        
        {# Profile placeholder - can be expanded later #}
        <a 
            href="#"
            class="flex flex-col items-center justify-center flex-1 h-full text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
            aria-label="Perfil"
        >
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <span class="text-xs mt-1">Perfil</span>
        </a>
    </div>
</nav>

{# Modal for quick transaction add - using native dialog element #}
<dialog
    x-data="{ open: false }"
    @open-transaction-modal.window="open = true; $refs.dialog.showModal()"
    @close-dialog.window="open = false; $refs.dialog.close()"
    @click.away="if ($event.target === $refs.dialog) { open = false; $refs.dialog.close() }"
    x-ref="dialog"
    class="rounded-lg shadow-xl max-w-md w-full p-0 backdrop:bg-black/50"
>
    <div 
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 scale-90"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-90"
        class="p-6"
    >
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Nova Transação</h2>
            <button
                @click="open = false; $refs.dialog.close()"
                class="text-gray-400 hover:text-gray-600"
                aria-label="Fechar"
            >
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div 
            hx-get="{% url 'transaction_quick_form' %}"
            hx-trigger="load"
            hx-swap="innerHTML"
            class="space-y-4"
        >
            {# Loading state #}
            <div class="flex items-center justify-center py-8">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
            </div>
        </div>
    </div>
</dialog>

{# Add bottom padding to main content on mobile to avoid overlap with bottom nav #}
<style>
    @media (max-width: 768px) {
        main {
            padding-bottom: 5rem; /* 4rem nav + 1rem spacing */
        }
    }
</style>

