{# Monthly Flow widget for dashboard - shows current month income and spending #}
{% load money_filters %}
{% load humanize %}
{% load math_filters %}

<div class="luma-panel rounded-3xl p-6 relative overflow-hidden h-full">
    <div class="absolute -right-6 -top-6 w-32 h-32 bg-emerald-500/10 rounded-full blur-2xl"></div>
    
    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-6 relative z-10">Monthly Flow</h3>
    
    <div class="space-y-6 relative z-10">
        <div>
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">Income</span>
                <span class="text-emerald-400 font-mono tracking-tight text-shadow-emerald">
                    +${{ monthly_income|default:0|floatformat:0|intcomma }}
                </span>
            </div>
            <div class="w-full bg-white/5 rounded-full h-1 overflow-hidden">
                {% if monthly_income and monthly_spending %}
                    {% with total=monthly_income|add:monthly_spending %}
                        {% if total > 0 %}
                            {% widthratio monthly_income total 100 as income_pct %}
                            <div class="bg-emerald-500 h-full rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]" style="--width: {{ income_pct|default:0|floatformat:0 }}%; width: var(--width);"></div>
                        {% else %}
                            <div class="bg-emerald-500 h-full rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]" style="width: 100%"></div>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <div class="bg-emerald-500 h-full rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]" style="width: 75%"></div>
                {% endif %}
            </div>
        </div>
        
        <div>
            <div class="flex justify-between text-sm mb-2">
                <span class="text-gray-400">Spending</span>
                <span class="text-rose-400 font-mono tracking-tight text-shadow-rose">
                    -${{ monthly_spending|default:0|floatformat:0|intcomma }}
                </span>
            </div>
            <div class="w-full bg-white/5 rounded-full h-1 overflow-hidden">
                {% if monthly_income and monthly_spending %}
                    {% with total=monthly_income|add:monthly_spending %}
                        {% if total > 0 %}
                            {% widthratio monthly_spending total 100 as spending_pct %}
                            <div class="bg-rose-500 h-full rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="--width: {{ spending_pct|default:0|floatformat:0 }}%; width: var(--width);"></div>
                        {% else %}
                            <div class="bg-rose-500 h-full rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="width: 25%"></div>
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <div class="bg-rose-500 h-full rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]" style="width: 25%"></div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

