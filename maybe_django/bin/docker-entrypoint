#!/bin/bash
set -e

# Wait for PostgreSQL to be ready
until PGPASSWORD="${DB_PASSWORD:-postgres}" psql -h "${DB_HOST:-localhost}" -U "${DB_USER:-postgres}" -d "${DB_NAME:-maybe_django}" -c '\q' > /dev/null 2>&1; do
  >&2 echo "PostgreSQL is unavailable - sleeping"
  sleep 1
done

>&2 echo "PostgreSQL is up - executing migrations"

# Run database migrations
python manage.py migrate --noinput

# Execute the command passed to the container
exec "$@"
